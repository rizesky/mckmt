# Demo Configurations

This directory contains configuration files specific to the MCKMT demo environment.

## Files

- `hub-demo.yaml` - Complete hub configuration with OIDC enabled
- `agent-demo.yaml` - Agent configuration for demo environment
- `oidc-config.yaml` - OIDC-specific configuration (generated by setup script)

## Quick Start

### 1. Start Demo Environment

```bash
# Start everything needed for demo (deps + OIDC + setup)
make demo
```

This will:
- Start PostgreSQL and Redis
- Start Keycloak OIDC provider
- Configure Keycloak with MCKMT settings
- Create test users and roles

### 2. Start MCKMT Services

```bash
# Terminal 1: Start Hub with OIDC
MCKMT_CONFIG_FILE=configs/demo/hub-demo.yaml go run cmd/hub/main.go

# Terminal 2: Start Agent
MCKMT_CONFIG_FILE=configs/demo/agent-demo.yaml go run cmd/agent/main.go
```

### 3. Test OIDC Authentication

1. Visit: http://localhost:8080/auth/oidc/login
2. Login with demo credentials:
   - **Admin**: `admin@mckmt.local` / `admin123`
   - **Viewer**: `test@mckmt.local` / `test123`

## Demo Features

### OIDC Authentication
- **Provider**: Keycloak running on http://localhost:8081
- **Realm**: `mckmt`
- **Client**: `mckmt-hub`
- **Roles**: admin, operator, viewer

### Test Users
- `admin@mckmt.local` - Full admin access
- `test@mckmt.local` - Read-only viewer access

### Services
- **Hub API**: http://localhost:8080
- **Keycloak**: http://localhost:8081
- **Keycloak Admin**: http://localhost:8081/admin (admin/admin123)

## Configuration Details

### Hub Demo Configuration
- OIDC authentication enabled
- Demo JWT secret (change in production)
- Metrics enabled
- Debug logging level

### Agent Demo Configuration
- Connects to localhost hub
- 30-second heartbeat interval
- Metrics enabled
- Debug logging level

## Customization

### Adding More Users
1. Access Keycloak admin console: http://localhost:8081/admin
2. Navigate to Users → Add User
3. Set username, email, and password
4. Assign roles in the Role Mappings tab

### Changing OIDC Settings
1. Edit `oidc-config.yaml`
2. Update Keycloak client settings in admin console
3. Restart MCKMT hub

### Adding More Roles
1. Access Keycloak admin console
2. Navigate to Realm Roles → Create Role
3. Update MCKMT RBAC configuration if needed

## Troubleshooting

### Keycloak Not Starting
```bash
# Check logs
docker logs mckmt-keycloak

# Restart
cd deployments/docker
docker compose -f docker-compose.yaml -f docker-compose.oidc.yml restart keycloak
```

### OIDC Login Failing
1. Verify Keycloak is running: http://localhost:8081
2. Check client configuration in Keycloak admin
3. Verify redirect URLs match
4. Check MCKMT hub logs

### User Not Created
1. Check MCKMT hub logs for OIDC errors
2. Verify database connection
3. Check OIDC configuration values

## Production Notes

⚠️ **These configurations are for demo/development only!**

For production:
- Change all default passwords and secrets
- Use HTTPS
- Configure proper SSL certificates
- Use external database for Keycloak
- Set up proper backup procedures
- Configure email settings
- Use environment variables for secrets
